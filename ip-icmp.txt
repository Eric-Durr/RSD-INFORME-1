----- DOCUMENTO DE RESPUESTAS PARA LA P2 -----

RESUMEN:
    obj: conocer estructura de paquete IP y campos de cabecera, fragmentación ipv4, utilidad y necesidad de ICMP, comandos ping y traceroute

    Protocolo IP:   
                    - mover datagramas entre un conjunto de redes interconectadas, pasándolos de un módulo a otro hasta el destino.
                    - los módulos residen en hosts y pasarelas en internet.
                    - se encaminan a través de redes individualesmediante la interpretación de una dirección internet <- importancia de un mecanismo.
                    - en el enrutamiento entre módulos los datagramas pueden necesitar atravesar una red de menor tamaño 
                      máximo de paquete -> mecanismo de fragmentación.
                    - para que funcione bien se requiere añadir una cabecera IP a cada datagrama enviado.
                    - la cabecera contiene toda la información necesaria para que hosts y routers puedan encaminarlos a sus 
                      destinos y fragmentarlos cuando sea necesario.
    Protocolo ICMP: 
                    - Es un protocolo de mensajes de control de internet (ICMP) 
                    - usa el soporte básico de IP como un protocolo de nivel superior (es una parte de IP realmente)
                    - se envían cuando:
                                        · un datagrama no puede alcanzar su destino.
                                        · una pasarela no dispone de almacenamiento temporal. 
                                        · cuando la pasarela puede dirigir al host para emitir por una ruta más corta
                    - IP no fue diseñado para ser 100% fiable -> ICMP no lo convierte en fiable.
                    - el propósito de ICMP tiene como propósito suministrar información sobre los problemas del entorno.
                    - Los protocolos superiores a IP deben implementar sus propias soluciones de fiabilidad.

    Comando ping: 
                    - Utiliza el protocolo ICMP -> envía una petición de eco a un host o router.
                    - al emitir echo request se recibe un echo response -> estos datagramas se componen por:
                        · (cabecera IP) + (cabecera ICMP) + (carga util: estampa de tiempo y numero de bytes de relleno)
                    - con el mecanismo se pretende averiguar si el nodo destino es alcanzable +  tiempo de ida y vuelta.
                    
    Comando traceroute:
                    - determinar el recorrido entre dos hosts -- usa --> campo TTL de la cabecera IP
                    - un paquete podría quedar vagando infinitamente por la red --> debe existir un mecanismo que detecte esto.
                    - El campo TTL asigna un valor por defecto (64) en el emisor, dicho valor decrementa al cruzar un router.
                    - si el valor llega a 0 el paquete es descartado y se envía un mensaje ICMP (TTL exceeded) al emisor.
                    - Traceroute construye un paquete para emitirlo entre dos hosts -> TTL toma el valor 1 en este caso.
                    - Vuelve al emisor tras devolverlo el primer router -> ahora se emite con  TTL valor 2 (causando otro mensaje ICMP)
                    - El proceso sigue hasta alcanzar el destino -> all llegar toma la carga util y la interpreta:
                            
                            · Carga útil como mensaje ICMP "Echo request" -> se responde con Echo reply.
                            · Carga útil como datagrama UDP a un puerto aleatorio -> se responde con Destination unreachable (ICMP)
                            · Carga útil como segmento TCP a un puerto aleatorio +  flag de sincronización activo -> Destination unreachable (ICMP) 

                            (cuando el host emisor recibe el mensaje se termina la traza y se finaliza el proceso)


PREGUNTAs PASO 1 ( Estudio de los mensajes ICMP asociados al comando ping)


 1 - ¿Cuál es la dirección IP de su ordenador? ¿Cuál es la dirección IP del nodo destino?

  La dirección IP de mi ordenador, en este caso, corresponde al extremo emisor de la comunicación 
  o host origen, su valor es aquél que indica el campo "Source" de wireshark 192.186.1.87. 

  Por otro lado el nodo destino recibe la dirección IP del extremo receptor de la comunicación ante un mensaje Echo request
  de ICMP. Este valor se puede comprobar en el campo "Destination" de wireshark 216.58.211.227.

  Al emitir una Echo reply los campos de Destination y Source son intercambiados, tal y como la lógica de la emisión-recepción
  de mensajes indica.


  2 - ¿Por qué un paquete ICMP no tiene un numero de destino y de origen?
       
    Esto puede explicarse por la definición del propósito del propio protocolo. Dado que este no toma la responsabilidad de emitir
    ni recibir paquetes, solo de informar de errores, se abstrae de las direcciones de destino y origen. Difiere de esta manera de 
    los protocolos de la capa de enlace (como TCP y UDP), es un protocolo complementario a IP que cubre la necesidad de informar 
    ante distintas situaciones de la comunicación. ping y traceroute son una excepción al uso de aplicaciones de usuario de este 
    protocolo.


  3 - Examine uno de los paquetes echo request emitidos por su ordenador. ¿Cuál es el código y el tipo?
      ¿Qué otros campos tienen paquetes ICMP de este tipo? ¿Cuántos bytes ocupan la suma de comprobación
      (checksum), el numero de secuencia y el identificador?

      Este paquete corresponde a uno de los distintos tipos de paquete del protocolo ICMP. En concreto el
      tipo de un mensaje de control Echo request es el 8 (0x08). Este tipo de código se localiza en el primer
      byte de la cabecera ICMP, el siguiente corresponde al código al que hace alusión el enunciado.

      Los siguientes 16 bits (los octetos 3 y 4) corresponde al checksum (suma de comprobación) empleado en la
      detección de errores. Los últimos 4 bytes varían según el tipo del código ICMP.

      El código junto al tipo expresa el subtipo. En este caso es 0, dado que por definición debe ser así cuando 
      se trata de un tipo Echo request.

      En el caso de un Echo request los bytes 5 y 6 son ocupados por el identificador y el número de secuencia
      consecutivamente. finalmente los últimos 4 bytes ocupan los datos del mensaje.

      Respecto a los campos de los paquetes ICMP son los siguientes:
        -------- TIPO ( 1 byte ) --------
        - type -> 8 por Echo request
        -------- CÓDIGO ( 1 byte ) --------
        - code -> 0 por Echo request
        -------- SUMA DE COMPROBACIÓN ( 2 bytes ) --------
        - checksum -> [número] [correcto/fallido]
        + estatus de comprobación
        -------- IDENTIFICADOR ( 2 bytes ) --------
        - Identifyer (BE) [numero] parte 1
        - Identifyer (LE) [numero] parte 2
        -------- NUMERO DE SECUENCIA ( 2 bytes ) --------
        - Sequence num (BE) [numero] parte 1
        - Sequence num (LE) [numero] parte 2
        + marco de respuesta
        -------- SECCIÓN DE DATOS ( 4 bytes ) --------
        - Timestamp from icmp data: datos de la estampa de tiempo (fecha)
        + tiempo necesitado
        - Data (datos de relleno)



PREGUNTAS DEL PROTOCOLO ICP